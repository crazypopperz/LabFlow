<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Gestion des Kits de Réservation</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="{{ url_for('static', filename='js/script.js') }}" defer></script>
</head>
<body>
    {% include 'header.html' %}
    <div class="main-container">

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                {% for category, message in messages %}
                    <div class="flash {{ category }}">{{ message }}</div>
                {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
		
		{% include '_breadcrumb.html' %}

        <div class="management-header">
            <h2 class="page-title">
                <svg xmlns="http://www.w3.org/2000/svg" class="page-title-icon" viewBox="0 -960 960 960"><path d="M756-120 537-339l84-84 219 219-84 84Zm-552 0-84-84 276-276-68-68-28 28-51-51v82l-28 28-121-121 28-28h82l-50-50 142-142q20-20 43-29t47-9q24 0 47 9t43 29l-92 92 50 50-28 28 68 68 90-90q-4-11-6.5-23t-2.5-24q0-59 40.5-99.5T701-841q15 0 28.5 3t27.5 9l-99 99 72 72 99-99q7 14 9.5 27.5T841-701q0 59-40.5 99.5T701-561q-12 0-24-2t-23-7L204-120Z"/></svg>
                <span>Gestion des Kits de Réservation</span>
            </h2>
        </div>
        
        <div class="page-actions-container">
            <button class="btn-action" data-modal-trigger="add-kit-modal">Créer un nouveau kit</button>
        </div>

        <div class="card-container management-page">
            {% for item in kits %}
			<div class="item-card">
				<div class="card-info">
					<!-- On accède à l'objet Kit via item.Kit -->
					<a href="{{ url_for('admin.modifier_kit', kit_id=item.Kit.id) }}" class="card-title-link">
						<span class="card-title"><strong>{{ item.Kit.nom }}</strong></span>
					</a>
					<span class="card-description">{{ item.Kit.description }}</span>
					<span class="card-count">
						<!-- On accède au compte via item.count -->
						{% if item.count == 0 %}Aucun objet
						{% elif item.count == 1 %}1 objet
						{% else %}{{ item.count }} objets
						{% endif %}
					</span>
				</div>
				<div class="card-actions">
					<!-- Mêmes corrections ici -->
					<a href="{{ url_for('admin.modifier_kit', kit_id=item.Kit.id) }}" title="Modifier le kit"><svg style="width:24px;height:24px" viewBox="0 0 24 24"><path fill="currentColor" d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.13,5.12L18.88,8.87M3,17.25V21H6.75L17.81,9.94L14.06,6.19L3,17.25Z" /></svg></a>
					<button type="button" class="btn-danger btn-open-danger-modal"
							data-action="{{ url_for('admin.supprimer_kit', kit_id=item.Kit.id) }}"
							data-message="Êtes-vous sûr de vouloir supprimer le kit '{{ item.Kit.nom }}' ?">
						Supprimer
					</button>
				</div>
			</div>
			{% else %}
                <p>Aucun kit n'a été créé pour le moment.</p>
            {% endfor %}
        </div>
    </div>

    <!-- Modale pour ajouter un nouveau kit -->
    <div id="add-kit-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title-with-icon">Créer un nouveau kit</h3>
                <button class="close-btn">×</button>
            </div>
            <form action="{{ url_for('admin.ajouter_kit') }}" method="post" class="modal-form">
			<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
				<div class="form-group">
					<label for="nom">Nom du kit :</label>
					<input type="text" id="nom" name="nom" required placeholder="Ex: Kit TP Chimie N°5">
				</div>
				<div class="form-group">
					<label for="description">Description (optionnel) :</label>
					<textarea id="description" name="description" rows="3" placeholder="Ex: Matériel nécessaire pour la manipulation sur les acides-bases."></textarea>
				</div>
				<div class="modal-actions">
					<button type="button" class="btn-action">Annuler</button>
					<button type="submit" class="btn-action">Créer et configurer</button>
				</div>
			</form>
        </div>
    </div>

    {% include 'footer.html' %}
	{% include '_modale_danger.html' %}
</body>
</html>