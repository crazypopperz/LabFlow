{% if pagination.total_pages > 1 %}
{# --- CORRECTIF : On nettoie les arguments pour éviter le doublon de 'page' --- #}
{% set args = request.args.copy() %}
{% set _ = args.pop('page', None) %}

<!-- Conteneur d'espacement et de séparation -->
<div class="d-flex justify-content-center mt-4 pt-3 border-top border-light-subtle">
    <nav aria-label="Navigation des pages">
        <ul class="pagination mb-0 shadow-sm">
            
            <!-- Bouton Précédent -->
            <li class="page-item {{ 'disabled' if pagination.page == 1 }}">
                <a class="page-link {{ 'bg-light text-muted' if pagination.page == 1 }}" 
                   href="{{ url_for(pagination.endpoint, page=pagination.page - 1, **args) if pagination.page > 1 else '#' }}"
                   aria-label="Précédent">
                    <span aria-hidden="true">&laquo; Précédent</span>
                </a>
            </li>

            <!-- Numéros de page (Logique intelligente pour ne pas tout afficher) -->
            {% for p in range(1, pagination.total_pages + 1) %}
                <!-- On affiche la première, la dernière, la courante, et les voisines -->
                {% if p == 1 or p == pagination.total_pages or (p >= pagination.page - 2 and p <= pagination.page + 2) %}
                    <li class="page-item {{ 'active' if p == pagination.page }}">
                        <a class="page-link {{ 'fw-bold' if p == pagination.page }}" 
                           href="{{ url_for(pagination.endpoint, page=p, **args) }}">
                            {{ p }}
                        </a>
                    </li>
                {% elif p == pagination.page - 3 or p == pagination.page + 3 %}
                    <li class="page-item disabled">
                        <span class="page-link border-0 bg-transparent">...</span>
                    </li>
                {% endif %}
            {% endfor %}

            <!-- Bouton Suivant -->
            <li class="page-item {{ 'disabled' if pagination.page == pagination.total_pages }}">
                <a class="page-link {{ 'bg-light text-muted' if pagination.page == pagination.total_pages }}" 
                   href="{{ url_for(pagination.endpoint, page=pagination.page + 1, **args) if pagination.page < pagination.total_pages else '#' }}"
                   aria-label="Suivant">
                    <span aria-hidden="true">Suivant &raquo;</span>
                </a>
            </li>
            
        </ul>
    </nav>
</div>
{% endif %}