<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>{% block title %}LabFlow{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    {% block head_styles %}{% endblock %}
</head>
<body>
    <!-- ON DÉPLACE LE BLOC DES MESSAGES ICI, EN HAUT DU BODY -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <!-- Ce conteneur est invisible, il ne sert qu'à stocker les messages pour le JS -->
            <div id="flash-messages-container" style="display: none;">
                {% for category, message in messages %}
                    <div class="flash-message" data-category="{{ category }}" data-message="{{ message }}"></div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    {% include 'header.html' %}
    {% include 'sub_header.html' %}

    <main class="main-content">
        <!-- ON SUPPRIME L'ANCIEN BLOC DE MESSAGES QUI ÉTAIT ICI -->
        {% block content %}{% endblock %}
    </main>
	
    {% include 'footer.html' %}
    {% include '_modals.html' %}

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}" defer></script>
	<script src="{{ url_for('static', filename='js/modules/booking-modal.js') }}" type="module"></script>
    
    <!-- AJOUT : Un script pour gérer les toasts -->
    <script type="module">
        import { showToast } from "{{ url_for('static', filename='js/modules/toast.js') }}";

        document.addEventListener('DOMContentLoaded', () => {
            const messagesContainer = document.getElementById('flash-messages-container');
            if (messagesContainer) {
                const messages = messagesContainer.querySelectorAll('.flash-message');
                messages.forEach(msg => {
                    const category = msg.dataset.category; // 'success', 'error', etc.
                    const message = msg.dataset.message;
                    showToast(message, category);
                });
            }
        });
    </script>

    {% block scripts %}{% endblock %}
		<div id="tour-overlay" class="tour-overlay"></div>
		<div id="tour-tooltip" class="tour-tooltip">
			<div id="tour-title" class="tour-title">Titre de l'étape</div>
			<div id="tour-content" class="tour-content">Description de l'étape...</div>
			<div class="tour-actions">
				<button id="tour-btn-skip" class="tour-btn-skip">Passer</button>
				<button id="tour-btn-next" class="tour-btn-next">Suivant</button></div>
		</div>
</body>
</html>